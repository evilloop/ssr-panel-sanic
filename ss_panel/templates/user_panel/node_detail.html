{% extends 'user_panel/user_panel_base.html' %}

{% block bodybox %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <section class="content-header">
        <h1>
            节点列表
            <small>Node List</small>
        </h1>
    </section>
    <!-- Modal -->
    <div class="modal fade" id="open-app-failed" tabindex="-1" role="dialog" aria-labelledby="open-app-failed" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>
            <h4 class="modal-title" id="myModalLabel">打开App失败</h4>
          </div>
          <div class="modal-body">
            请确认此手机已安装 SS(R) 客户端。
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Main content -->
    <section class="content">
        <!-- START PROGRESS BARS -->
        <div class="row">
            <div class="col-md-12">
                <div class="callout callout-warning">
                    <h4>注意!</h4>

                    <p>配置文件以及二维码请勿泄露！</p>
                </div>
            </div>
            <!--<div class="col-md-6">-->
                <!--<div class="box box-solid">-->
                    <!--<div class="box-header">-->
                        <!--<i class="fa fa-code"></i>-->

                        <!--<h3 class="box-title">配置Json</h3>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-header &ndash;&gt;-->
                    <!--<div class="box-body">-->
                        <!--<textarea class="form-control" {% if user.obfs in ('http_post', 'http_simple') %} rows="9" {% else %} rows="8" {% endif %}>{{ ss_info_show }}</textarea>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-body &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.box &ndash;&gt;-->
                <!--<div class="box box-solid">-->
                    <!--<div class="box-header">-->
                        <!--<i class="fa fa-code"></i>-->

                        <!--<h3 class="box-title">配置地址</h3>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-header &ndash;&gt;-->
                    <!--<div class="box-body">-->
                    <!--{% if user.obfs in ('http_simple', 'http_post', 'random_head', 'tls1.2_ticket_auth') or user.protocol in ('verify_deflate', 'auth_chain_a', 'auth_sha1_v4', 'auth_aes128_md5', 'auth_aes128_sha1') %}-->
                        <!--<input id="ss-qr-text" class="form-control" value="{{ ssqr_s_n }}">-->
                        <!--<p></p>-->
                        <!--<p> 当前连接配置不兼容 SS 客户端 </p>-->
                        <!--<a href="{{ ssqr_s_n }}">Android 手机上用默认浏览器点我添加 SSR 配置到客户端</a>-->
                    <!--{% else %}-->
                        <!--<input id="ss-qr-text" class="form-control" value="{{ ssqr }}">-->
                        <!--<p></p>-->
                        <!--&lt;!&ndash;<p>当前连接配置兼容 SS 客户端</p>&ndash;&gt;-->
                        <!--<a href="{{ ssqr }}"/>Android 手机上用默认浏览器点我添加 SS 配置到客户端</a>-->
                        <!--<p></p>-->
                        <!--<input id="ss-qr-text" class="form-control" value="{{ ssqr_s_n }}">-->
                        <!--<p></p>-->
                        <!--<a href="{{ ssqr_s_n }}">Android 手机上用默认浏览器点我添加 SSR 配置到客户端 </a>-->
                    <!--{% endif %}-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-body &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.box &ndash;&gt;-->
            <!--</div>-->
            <!--&lt;!&ndash; /.col (right) &ndash;&gt;-->

            <!-- /.col (right) -->
            <!--<div class="col-md-6">-->
                <!--<div class="box box-solid">-->
                    <!--<div class="box-header">-->
                        <!--<i class="fa fa-qrcode"></i>-->

                        <!--<h3 class="box-title"> 旧版ShadowsocksR配置二维码</h3>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-header &ndash;&gt;-->
                    <!--<div class="box-body">-->
                        <!--<div class="text-center">-->
                            <!--<div id="ss-qr"></div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-body &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.box &ndash;&gt;-->
            <!--</div>-->
            <!--&lt;!&ndash; /.col (right) &ndash;&gt;-->

            <div class="col-md-6">
                <div class="box box-solid">
                    <div class="box-header">
                        <i class="fa fa-qrcode"></i>

                        <h3 class="box-title"> SSR 配置</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="text-center">
                            <div id="ss-qr-n"></div>
                            <!--<p></p>-->
                            <!--<input id="ss-qr-text" class="form-control" value="{{ ssqr_s_n }}">-->
                            <p></p>
                            <a class="open-app" href="{{ ssqr_s_n }}">Android 手机浏览器点我添加 SSR 配置到客户端 </a>
                            <p></p>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col (right) -->
            <!--<div class="col-md-6">-->
                <!--<div class="box box-solid">-->
                    <!--<div class="box-header">-->
                        <!--<i class="fa fa-qrcode"></i>-->

                        <!--<h3 class="box-title"> 旧版ShadowsocksR配置二维码</h3>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-header &ndash;&gt;-->
                    <!--<div class="box-body">-->
                        <!--<div class="text-center">-->
                            <!--<div id="ss-qr"></div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; /.box-body &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.box &ndash;&gt;-->
            <!--</div>-->
            <!--&lt;!&ndash; /.col (right) &ndash;&gt;-->

            {% if (user.obfs == 'origin' or user.obfs.endswith('_compatible')) and (user.protocol == 'plain' or user.protocol.endswith('_compatible')) %}
            <div class="col-md-6">
                <div class="box box-solid">
                    <div class="box-header">
                        <i class="fa fa-qrcode"></i>

                        <h3 class="box-title">SS 配置</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="text-center">
                            <div id="ss-qr-y"></div>
                            <!--<p></p>-->
                            <!--<input id="ss-qr-text" class="form-control" value="{{ ssqr }}">-->
                            <p></p>
                            <a class="open-app" href="{{ ssqr }}"/>Android 手机浏览器点我添加 SS 配置到客户端</a>
                            <p></p>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col (right) -->
            {% endif %}

        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="box box-solid">
                    <div class="box-header">
                        <i class="fa fa-qrcode"></i>

                        <h3 class="box-title">Surge 配置</h3>
                    </div>
                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h4>Surge 使用步骤</h4>

                                <p>基础配置只需要做一次：
                                <ol>
                                    <li>打开 Surge ，点击右上角“Edit”，点击“Download Configuration from URL”</li>
                                    <li>输入基础配置的地址（或扫描二维码得到地址，复制后粘贴进来），点击“OK”</li>
                                    <li><b>注意：</b>基础配置不要改名，不可以直接启用。</li>
                                </ol>
                                </p>
                                <p>代理配置需要根据不同的节点进行添加：
                                <ol>
                                    <li>点击“New Empty Configuration”</li>
                                    <li>在“NAME”里面输入一个配置文件的名称</li>
                                    <li>点击下方“Edit in Text Mode”</li>
                                    <li>输入代理配置的全部文字（或扫描二维码得到配置，复制后粘贴进来），点击“OK”</li>
                                    <li>直接启用代理配置即可科学上网。</li>
                                </ol>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <h4>基础配置</h4>

                                <div class="text-center">
                                    <div id="surge-base-qr"></div>
                                </div>
                                <textarea id="surge-base-text" class="form-control" rows="6">{{ surge_base }}</textarea>
                            </div>
                            <div class="col-md-4">
                                <h4>代理配置</h4>

                                <div class="text-center">
                                    <div id="surge-proxy-qr"></div>
                                </div>
                                <textarea id="surge-proxy-text" class="form-control" rows="6">{{ surge_proxy }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->
        <!-- END PROGRESS BARS -->
        <script src=" /static/js/jquery.qrcode.min.js "></script>
        <script>
            $('.open-app').click(function() {
                var _clickTime = +(new Date());
                function check(elsTime) {
                    if (elsTime > 2500 || document.hidden || document.webkitHidden || document.mozHidden) {
                        // open app success
                    } else {
                        // open app failed
                        $('#open-app-failed').modal('show');
                    }
                }
                // 启动间隔20ms运行的定时器，循环100次
                var _count = 0, intHandle;
                intHandle = setInterval(function(){
                    _count++;
                    var elsTime = +(new Date()) - _clickTime;
                    if (_count>=100 || elsTime > 2500 ) {
                        clearInterval(intHandle);
                        check(elsTime);
                    }
                }, 20);
            });

            var text_qrcode_n = '{{ ssqr_s_n }}';
	          jQuery('#ss-qr-n').qrcode({
		            "text": text_qrcode_n
	          });

            var text_qrcode = '{{ ssqr_s }}';
	          jQuery('#ss-qr').qrcode({
		            "text": text_qrcode
	          });

            {% if (user.obfs == 'origin' or user.obfs.endswith('_compatible')) and (user.protocol == 'plain' or user.protocol.endswith('_compatible')) %}
            var text_qrcode_y = '{{ ssqr }}';
	          jQuery('#ss-qr-y').qrcode({
		            "text": text_qrcode_y
            });
            {% endif %}

            var text_surge_base = jQuery('#surge-base-text').val();
            jQuery('#surge-base-qr').qrcode({
                "text": text_surge_base
            });
            var text_surge_proxy = jQuery('#surge-proxy-text').text();
            jQuery('#surge-proxy-qr').qrcode({
                "text": text_surge_proxy
            });
        </script>
    </section>
    <!-- /.content -->
</div><!-- /.content-wrapper -->
{% endblock %}